<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>FitTrack ‚Äì Blood Pressure</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6fb;
      padding: 20px;
    }
    h1 {
      text-align: center;
    }
    .card {
      background: white;
      padding: 20px;
      max-width: 500px;
      margin: 20px auto;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 15px;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      font-size: 16px;
    }
    button {
      margin-top: 20px;
      background: #4f46e5;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    button:hover {
      background: #4338ca;
    }
    .entry {
      background: #eef2ff;
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
      font-size: 14px;
    }
  </style>
</head>

<body>

<h1>ü©∫ FitTrack ‚Äì Blood Pressure</h1>

<div class="card">
  <form id="bpForm">
    <label>Utilisateur</label>
    <select id="bpUser" required>
      <option value="user1">User 1</option>
      <option value="user2">User 2</option>
    </select>

    <label>Systolic (mmHg)</label>
    <input type="number" id="bpSystolic" required min="70" max="250" />

    <label>Diastolic (mmHg)</label>
    <input type="number" id="bpDiastolic" required min="40" max="150" />

    <label>Heart Rate (bpm)</label>
    <input type="number" id="bpHeartRate" min="40" max="200" />

    <button type="submit">üíæ Enregistrer</button>
  </form>
</div>

<div class="card">
  <h3>üìä Historique</h3>
  <div id="bpList">Chargement‚Ä¶</div>
</div>

<script>
/* ================================
   CONFIG
================================ */
const API_URL =
  "https://script.google.com/macros/s/AKfycbzSUQKE-bpzQ1H5iYD350DSFoqK55hb4Aip6PfDGz1wfrJ2I-DEWpaGe2hHI4T1bzZe5A/exec";

/* ================================
   STATE
================================ */
let bloodPressures = [];

/* ================================
   LOAD DATA FROM GOOGLE SHEETS
================================ */
async function loadBP() {
  const res = await fetch(API_URL + "?action=bp");
  const data = await res.json();

  if (data.ok) {
    bloodPressures = data.rows;
    renderBP();
  } else {
    document.getElementById("bpList").innerText = "Erreur de chargement";
  }
}

/* ================================
   RENDER
================================ */
function renderBP() {
  const container = document.getElementById("bpList");
  container.innerHTML = "";

  if (bloodPressures.length === 0) {
    container.innerText = "Aucune donn√©e";
    return;
  }

  bloodPressures
    .slice()
    .reverse()
    .forEach(bp => {
      const div = document.createElement("div");
      div.className = "entry";
      div.innerHTML = `
        <strong>${bp.user}</strong><br>
        ${bp.systolic}/${bp.diastolic} mmHg
        ${bp.heartRate ? " ‚Äì ‚ù§Ô∏è " + bp.heartRate + " bpm" : ""}
        <br>
        <small>${bp.date || ""}</small>
      `;
      container.appendChild(div);
    });
}

/* ================================
   SAVE BP TO GOOGLE SHEETS
================================ */
document.getElementById("bpForm").addEventListener("submit", async e => {
  e.preventDefault();

  const bp = {
    action: "bp_add",
    user: document.getElementById("bpUser").value,
    systolic: document.getElementById("bpSystolic").value,
    diastolic: document.getElementById("bpDiastolic").value,
    heartRate: document.getElementById("bpHeartRate").value,
    date: new Date().toISOString().split("T")[0],
    timestamp: new Date().toISOString()
  };

  await fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "text/plain;charset=utf-8" },
    body: JSON.stringify(bp)
  });

  e.target.reset();
  await loadBP();
  alert("‚úÖ Donn√©e enregistr√©e");
});

/* ================================
   INIT
================================ */
loadBP();
</script>

</body>
</html>
